<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Airport Operations | Lost &amp; Found Platform</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Manrope:wght@500;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='lost_found.css') }}" />
</head>
<body>
  <div class="bg-noise" aria-hidden="true"></div>
  <main class="platform-shell">
    <header class="platform-hero">
      <div>
        <p class="eyebrow">Airport Operations Platform</p>
        <h1>Lost &amp; Found Command Center</h1>
        <p class="hero-copy">
          A professional, passenger-first system for reporting missing items, tracking progress, and managing staff workflow.
        </p>
      </div>
      <a class="admin-link" href="{{ url_for('admin_login') }}">Staff Workflow Login</a>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <section class="flash-stack" aria-live="polite">
          {% for category, message in messages %}
            <div class="flash flash-{{ category }}">{{ message }}</div>
          {% endfor %}
        </section>
      {% endif %}
    {% endwith %}

    <section class="metrics-grid">
      <article class="metric-card">
        <p>Total Reports</p>
        <h3>{{ metrics.total }}</h3>
      </article>
      <article class="metric-card">
        <p>Items Found</p>
        <h3>{{ metrics.found }}</h3>
      </article>
      <article class="metric-card">
        <p>Ready for Pickup</p>
        <h3>{{ metrics.ready }}</h3>
      </article>
      <article class="metric-card">
        <p>Claimed Items</p>
        <h3>{{ metrics.claimed }}</h3>
      </article>
    </section>

    <section class="module-nav" aria-label="Workflow Modules">
      <button class="module-tab {% if active_panel == 'report' %}active{% endif %}" type="button" data-target="report">Passenger Report Form</button>
      <button class="module-tab {% if active_panel == 'verification' %}active{% endif %}" type="button" data-target="verification">Claim Verification</button>
      <button class="module-tab {% if active_panel == 'dashboard' %}active{% endif %}" type="button" data-target="dashboard">Tracking Dashboard</button>
      <button class="module-tab {% if active_panel == 'workflow' %}active{% endif %}" type="button" data-target="workflow">Staff Workflow</button>
    </section>

    <section class="module-panels" data-active="{{ active_panel }}">
      <article id="panel-report" class="module-card module-panel {% if active_panel == 'report' %}active{% endif %}">
        <h2>Passenger Report Form</h2>
        <p>Submit item details securely. A unique Tracking ID is generated instantly.</p>
        <form class="form-grid" method="post" action="{{ url_for('home') }}">
          <input type="hidden" name="action" value="report" />
          <label>
            Full Name
            <input type="text" name="passenger_name" placeholder="Enter your full name" required />
          </label>
          <label>
            Item Name
            <input type="text" name="item_name" placeholder="Example: Black iPad Pro" required />
          </label>
          <label class="full-width">
            Description
            <textarea name="description" rows="4" placeholder="Describe color, brand, location, and time details." required></textarea>
          </label>
          <button class="primary-btn" type="submit">Submit Report</button>
        </form>

        {% if latest_tracking_id %}
          <div class="tracking-id-box">
            <p>Tracking ID Created</p>
            <strong>{{ latest_tracking_id }}</strong>
          </div>
        {% endif %}
      </article>

      <article id="panel-verification" class="module-card module-panel {% if active_panel == 'verification' %}active{% endif %}">
        <h2>Claim Verification</h2>
        <p>Paste your Tracking ID to view item and claim status in real time.</p>
        <form class="form-inline" method="post" action="{{ url_for('home') }}">
          <input type="hidden" name="action" value="track" />
          <input type="text" name="tracking_id" placeholder="LF-YYMMDD-XXXXXX" required />
          <button class="primary-btn" type="submit">Track Item</button>
        </form>

        {% if search_result %}
          <section class="result-card">
            <div class="result-head">
              <h3>{{ search_result.item_name }}</h3>
              <span class="result-id">{{ search_result.tracking_id }}</span>
            </div>
            <p><strong>Passenger:</strong> {{ search_result.passenger_name }}</p>
            <p><strong>Description:</strong> {{ search_result.description }}</p>
            <div class="status-row">
              <span class="status-chip {% if search_result.found_status %}ok{% else %}hold{% endif %}">
                Item Status: {% if search_result.found_status %}Found{% else %}Not Found{% endif %}
              </span>
              <span class="status-chip {% if search_result.claim_status %}ok{% else %}wait{% endif %}">
                Claim Status: {% if search_result.claim_status %}Claimed{% else %}Unclaimed{% endif %}
              </span>
            </div>
            {% set step = pipeline_step(search_result) %}
            <ol class="pipeline">
              <li class="{% if step >= 1 %}done{% endif %}">Reported</li>
              <li class="{% if step >= 2 %}done{% endif %}">Found</li>
              <li class="{% if step >= 3 %}done{% endif %}">Ready for Pickup</li>
              <li class="{% if step >= 4 %}done{% endif %}">Claimed</li>
            </ol>
          </section>
        {% endif %}
      </article>

      <article id="panel-dashboard" class="module-card module-panel {% if active_panel == 'dashboard' %}active{% endif %}">
        <h2>Tracking Dashboard</h2>
        <p>Live overview of the latest reports and their operational status.</p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tracking ID</th>
                <th>Passenger</th>
                <th>Item</th>
                <th>Item Status</th>
                <th>Claim Status</th>
              </tr>
            </thead>
            <tbody>
              {% for row in recent_reports %}
                <tr>
                  <td>{{ row.tracking_id }}</td>
                  <td>{{ row.passenger_name }}</td>
                  <td>{{ row.item_name }}</td>
                  <td>
                    <span class="status-chip {% if row.found_status %}ok{% else %}hold{% endif %}">
                      {% if row.found_status %}Found{% else %}Not Found{% endif %}
                    </span>
                  </td>
                  <td>
                    <span class="status-chip {% if row.claim_status %}ok{% else %}wait{% endif %}">
                      {% if row.claim_status %}Claimed{% else %}Unclaimed{% endif %}
                    </span>
                  </td>
                </tr>
              {% else %}
                <tr>
                  <td colspan="5">No reports submitted yet.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </article>

      <article id="panel-workflow" class="module-card module-panel {% if active_panel == 'workflow' %}active{% endif %}">
        <h2>Staff Workflow &amp; Analytics</h2>
        <p>Secure module for airport staff to process found items and finalize claims.</p>
        <ul class="workflow-list">
          <li>View every report in an admin dashboard table.</li>
          <li>Update <strong>Found</strong> and <strong>Claimed</strong> status per tracking ID.</li>
          <li>Use clear workflow progression from report to handover completion.</li>
        </ul>
        <a class="primary-btn inline-btn" href="{{ url_for('admin_login') }}">Open Admin Panel</a>
      </article>
    </section>
  </main>

  <script src="{{ url_for('static', filename='lost_found.js') }}"></script>
</body>
</html>
